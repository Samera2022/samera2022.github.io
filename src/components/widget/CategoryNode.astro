---
import type { Category } from "../../utils/content-utils";
import ButtonLink from "../control/ButtonLink.astro";

interface Props {
	node: Category;
	depth?: number;
}

const { node, depth = 0 } = Astro.props;
const INDENT_PER_LEVEL = 12;
const indentPx = depth * INDENT_PER_LEVEL;
const hasChildren = node.children.length > 0;
---

{hasChildren ? (
	<div style={`margin-left: ${indentPx}px`}>
		<details class="group">
			<summary class="w-full h-10 rounded-lg bg-none hover:bg-[var(--btn-plain-bg-hover)] active:bg-[var(--btn-plain-bg-active)] transition-all pl-2 hover:pl-3 text-neutral-700 hover:text-[var(--primary)] dark:text-neutral-300 dark:hover:text-[var(--primary)] cursor-pointer list-none flex items-center justify-between">
				<div class="flex items-center gap-1">
					<span class="text-xs transition-transform group-open:rotate-90 inline-block">â–¶</span>
					<span class="overflow-hidden text-left whitespace-nowrap overflow-ellipsis">{node.name.trim()}</span>
				</div>
				{node.count > 0 && (
					<div class="transition px-2 h-7 mr-2 min-w-[2rem] rounded-lg text-sm font-bold text-[var(--btn-content)] dark:text-[var(--deep-text)] bg-[var(--btn-regular-bg)] dark:bg-[var(--primary)] flex items-center justify-center">
						{node.count}
					</div>
				)}
			</summary>
			<div class="ml-4 mt-1">
				{node.children.map((child) => (
					<Astro.self node={child} depth={depth + 1} />
				))}
			</div>
		</details>
	</div>
) : (
	<div style={`margin-left: ${indentPx}px`}>
		<ButtonLink
			url={node.url}
			badge={String(node.count)}
			label={`View all posts in the ${node.fullPath} category`}
		>
			{node.name.trim()}
		</ButtonLink>
	</div>
)}
